generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  username      String   @unique
  password_hash String
  firstName     String?
  lastName      String?
  email         String?
  role          Role     @default(TECHNICIAN)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Patient {
  id          Int               @id @default(autoincrement())
  fullName    String
  dateOfBirth DateTime
  gender      String
  address     String
  phone       String
  email       String?
  cin         String            @unique
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  deleted     Boolean           @default(false)
  analyses    AnalysisRequest[]
}

model AnalysisType {
  id            Int              @id @default(autoincrement())
  name          String           @unique
  unit          String
  reference_min Float
  reference_max Float
  price         Float
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  results       AnalysisResult[]
}

model AnalysisRequest {
  id         Int              @id @default(autoincrement())
  patientId  Int
  doctorName String
  status     AnalysisStatus   @default(EN_ATTENTE)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  patient    Patient          @relation(fields: [patientId], references: [id])
  results    AnalysisResult[]
}

model AnalysisResult {
  id             Int             @id @default(autoincrement())
  requestId      Int
  analysisTypeId Int
  value          Float?
  isAbnormal     Boolean         @default(false)
  measuredBy     Int?
  measuredAt     DateTime?
  isVoided       Boolean         @default(false)
  voidReason     String?
  voidedBy       Int?
  voidedAt       DateTime?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  analysisType   AnalysisType    @relation(fields: [analysisTypeId], references: [id])
  request        AnalysisRequest @relation(fields: [requestId], references: [id])
}

enum Role {
  ADMIN
  TECHNICIAN
  SECRETARY
  MEDECIN
}

enum AnalysisStatus {
  EN_ATTENTE
  COMPLETE
  VALIDE
}
